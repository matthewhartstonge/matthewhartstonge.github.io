<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Superfast WordPress | Matthew Hartstonge</title><meta name=keywords content="Cache,DevOps,Docker,Nginx,Optimization,opcache,php,php-fpm,WordPress,Varnish"><meta name=description content="Introduction WordPress is clearly one of the world&rsquo;s most used Content Management Systems (CMS) commanding over 35% of the internet, and over 60% of the CMS market [1].
Working in Operations (ops), you see your fair share of friends, family and businesses that ask you to set up a WordPress site as their go to blogging platform. This really comes down to WordPress&rsquo; ease of use, massive library of themes and it&rsquo;s modular nature that enables the extension of it&rsquo;s core via the use of plugins."><meta name=author content="Matthew Hartstonge"><link rel=canonical href=https://blog.mykro.co.nz/posts/2020-03-29-optimizing-wordpress/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href="https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=250"><link rel=icon type=image/png sizes=16x16 href="https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=16"><link rel=icon type=image/png sizes=32x32 href="https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=32"><link rel=apple-touch-icon href="https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=192"><link rel=mask-icon href="https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=64"><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-3N8ZQ0TS42"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3N8ZQ0TS42",{anonymize_ip:!1})}</script><meta property="og:title" content="Superfast WordPress"><meta property="og:description" content="Introduction WordPress is clearly one of the world&rsquo;s most used Content Management Systems (CMS) commanding over 35% of the internet, and over 60% of the CMS market [1].
Working in Operations (ops), you see your fair share of friends, family and businesses that ask you to set up a WordPress site as their go to blogging platform. This really comes down to WordPress&rsquo; ease of use, massive library of themes and it&rsquo;s modular nature that enables the extension of it&rsquo;s core via the use of plugins."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.mykro.co.nz/posts/2020-03-29-optimizing-wordpress/"><meta property="og:image" content="https://blog.mykro.co.nz/images/superfast-wordpress.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-29T19:00:00+13:00"><meta property="article:modified_time" content="2020-03-29T19:00:00+13:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.mykro.co.nz/images/superfast-wordpress.jpeg"><meta name=twitter:title content="Superfast WordPress"><meta name=twitter:description content="Introduction WordPress is clearly one of the world&rsquo;s most used Content Management Systems (CMS) commanding over 35% of the internet, and over 60% of the CMS market [1].
Working in Operations (ops), you see your fair share of friends, family and businesses that ask you to set up a WordPress site as their go to blogging platform. This really comes down to WordPress&rsquo; ease of use, massive library of themes and it&rsquo;s modular nature that enables the extension of it&rsquo;s core via the use of plugins."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.mykro.co.nz/posts/"},{"@type":"ListItem","position":2,"name":"Superfast WordPress","item":"https://blog.mykro.co.nz/posts/2020-03-29-optimizing-wordpress/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Superfast WordPress","name":"Superfast WordPress","description":"Introduction WordPress is clearly one of the world\u0026rsquo;s most used Content Management Systems (CMS) commanding over 35% of the internet, and over 60% of the CMS market [1].\nWorking in Operations (ops), you see your fair share of friends, family and businesses that ask you to set up a WordPress site as their go to blogging platform. This really comes down to WordPress\u0026rsquo; ease of use, massive library of themes and it\u0026rsquo;s modular nature that enables the extension of it\u0026rsquo;s core via the use of plugins.","keywords":["Cache","DevOps","Docker","Nginx","Optimization","opcache","php","php-fpm","WordPress","Varnish"],"articleBody":"Introduction WordPress is clearly one of the worldâ€™s most used Content Management Systems (CMS) commanding over 35% of the internet, and over 60% of the CMS market [1].\nWorking in Operations (ops), you see your fair share of friends, family and businesses that ask you to set up a WordPress site as their go to blogging platform. This really comes down to WordPressâ€™ ease of use, massive library of themes and itâ€™s modular nature that enables the extension of itâ€™s core via the use of plugins.\nAfter hearing one of my clients wanting to move forward with another WordPress site, I thought it was a good time to investigate PHP 7.2/.3/.4, clean up my docker-compose stack and experiment with different caching technologies in order to make it load as fast as possible for end-users.\nScience! ðŸ§ª Initially my WordPress deployment comprised of MySQL, php-fpm (PHP FastCGI Process Manager), and nginx with no caching optimizations. In order to work out if the optimizations were actually doing anything, I needed to gain a baseline benchmark using my current stack. Luckily, since everything was composed via docker, this was very easy to do.\nMethod In order to keep the variables under control the following hardware and software was used across all benchmark tests:\nHardware:\nMac Book Pro 2011 CPU: IntelÂ® Coreâ„¢ i7-2720QM CPU @ 2.20GHz Ã— 8 RAM: 3.8GiB OS: Ubuntu 18.04.4 64-bit Software:\nWordPress version 5.3.2 NGINX version 1.16.1 MariaDB version 10.4.12 Docker 19.03.8 Docker Compose v1.25.4 Hey v0.1.3 [2]. ~ Shameless Self Promotion ~\nstackme [3] - to provide a base docker-compose stack to get WordPress up and running. PHP Configurations:\nphp-fpm 7.2.28 php-fpm 7.2.28 + opcache php-fpm 7.2.28 + opcache + varnish cache php-fpm 7.2.28 + opcache + w3 total cache plugin php-fpm 7.2.28 + opcache + w3 total cache plugin + varnish cache php-fpm 7.3.15 php-fpm 7.3.15 + opcache php-fpm 7.3.15 + opcache + varnish cache php-fpm 7.3.15 + opcache + w3 total cache plugin php-fpm 7.3.15 + opcache + w3 total cache plugin + varnish cache php-fpm 7.4.3 php-fpm 7.4.3 + opcache php-fpm 7.4.3 + opcache + varnish cache php-fpm 7.4.3 + opcache + w3 total cache plugin php-fpm 7.4.3 + opcache + w3 total cache plugin + varnish cache I decided to opt for hey as the choice of benchmark tool, as itâ€™s similar to the apache benchmark tool (ab), but more modern, capable of using multiple cpus.\nOur default benchmark will be run using the following configuration:\nhey -z 60s -o csv http://localhost:80 This configures hey to flood the WordPress server for 60 seconds with requests, with a default of 50 worker threads.\nHypothesis PHP by itself will be the slowest PHP with OpCache should provide minor performance boosts PHP with w3TotalCache should be pretty performant, but will be limited by PHP. PHP with Varnish should be the fastest, as it doesnâ€™t have to hit PHP after initial page render. Results One thing I was surprised about was how much of a difference OpCache made in terms of processor usage and the impact that had to response time. I guess it shows how much overhead the interpreter can cause. (check out the screenshots under extras for nerds)\nHaving used other languages such as Python [4], and Java [5] I was somewhat surprised that PHPâ€™s OpCache wasnâ€™t added until 2012. Thatâ€™s only 8 years agoâ€¦\nThe other compounding issue with OpCache is that, while it has been bundled with PHP since version 5.5 [6], it may not be enabled by default depending on where you get the binary from, or if your php.ini file hasnâ€™t set opcache.enable=1. So make sure to enable this if you can!\nLastly, my hypothesis about Varnish turned out to be correct, but I did find that having W3TotalCache enabled as well added extra overhead, so you probably donâ€™t need to use both.\nfig 1. PHP Response Times and PHP With OpCache Enabled, without caching. fig 2. PHP With OpCache Enabled, with different caching strategies fig 3. Requests per Second, with different caching strategies Conclusion/TL;DR Where possible, always run PHP with OpCache enabled. If you canâ€™t run varnish, enable w3TotalCache - itâ€™s pretty damn performant. For best performance, run with varnish. Last Thoughts and Disclaimers This benchmark runs with the best performance you can get out of WordPress. Itâ€™s a fresh installation with no other plugins enabled. This enabled testing of the underlying technologies - therefore mileage may vary depending on how many plugins you have enabled on your WordPress site.\nI found to get the best out of W3TotalCache a lot of settings had to be tweaked to get it to work for anything other than the main/front page. So do experiment to ensure you get the best you can out of it.\nIn this benchmark, W3TotalCache was configured to make use of PHPâ€™s Alternative PHP Cache (APC) for object caching. APC provides an in memory caching API that developers can use.\nCertain default Caching technologies may not work well for sites that make use of backend processing on the fly. That said, if your WordPress site uses JavaScript to update the loaded page and API calls, you should be safe. In any case itâ€™s best to run a test site introducing your caching technology before fully rolling it out.\nExtras for Nerds â€˜Sup Nerds. Check out some extra graphs around system stats and overall performance with max response times.\nBenchmark repository including benchmark scripts, the raw data and database.\nMoar Response Time Graphs fig 4. Performance across all variants fig 5. PHP With OpCache Enabled, with different caching strategies, including Maximum Response time System Stats I grabbed screenshots for the first round of benchmarking to see what the impact each stack/configuration would have on CPU and RAM usage. RAM Usage was fairly similar, but CPU Usage differed a lot.\nfig 6. Base System Metrics fig 7. PHP 7.2 Metrics fig 8. PHP 7.2 OpCache Enabled Metrics fig 9. PHP 7.2 OpCache Enabled Metrics, With W3TotalCache fig 10. PHP 7.2 OpCache Enabled Metrics, With Varnish fig 11. PHP 7.2 OpCache Enabled Metrics, With W3TotalCache and Varnish Random I found it interesting that W3TotalCache injected an HTML comment, which could be useful while debugging performance metrics for those of you heading down the W3TotalCache route.\nfig 12. W3TotalCache adds caching information in an HTML comment Addendum Time to Blog: 16h:15m ","wordCount":"1057","inLanguage":"en","image":"https://blog.mykro.co.nz/images/superfast-wordpress.jpeg","datePublished":"2020-03-29T19:00:00+13:00","dateModified":"2020-03-29T19:00:00+13:00","author":{"@type":"Person","name":"Matthew Hartstonge"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.mykro.co.nz/posts/2020-03-29-optimizing-wordpress/"},"publisher":{"@type":"Organization","name":"Matthew Hartstonge","logo":{"@type":"ImageObject","url":"https://secure.gravatar.com/avatar/0f1d4fae9524fdcf157f93b20a55a1ac?size=250"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.mykro.co.nz/ accesskey=h title="Matthew Hartstonge (Alt + H)">Matthew Hartstonge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.mykro.co.nz/posts title=Blog><span>Blog</span></a></li><li><a href=https://blog.mykro.co.nz/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.mykro.co.nz/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Superfast WordPress</h1><div class=post-meta><span title='2020-03-29 19:00:00 +1300 NZDT'>March 29, 2020</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;Matthew Hartstonge</div></header><figure class=entry-cover><a href=https://blog.mykro.co.nz/images/superfast-wordpress.jpeg target=_blank rel="noopener noreferrer"><img loading=lazy src=https://blog.mykro.co.nz/images/superfast-wordpress.jpeg alt="A writer with a pencil drawing art around a track while sitting in a formula one car"></a></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#science- aria-label="Science! ðŸ§ª">Science! ðŸ§ª</a><ul><li><a href=#method aria-label=Method>Method</a></li><li><a href=#hypothesis aria-label=Hypothesis>Hypothesis</a></li></ul></li><li><a href=#results aria-label=Results>Results</a></li><li><a href=#conclusiontldr aria-label=Conclusion/TL;DR>Conclusion/TL;DR</a></li><li><a href=#last-thoughts-and-disclaimers aria-label="Last Thoughts and Disclaimers">Last Thoughts and Disclaimers</a></li><li><a href=#extras-for-nerds aria-label="Extras for Nerds">Extras for Nerds</a><ul><li><a href=#moar-response-time-graphs aria-label="Moar Response Time Graphs">Moar Response Time Graphs</a></li><li><a href=#system-stats aria-label="System Stats">System Stats</a></li><li><a href=#random aria-label=Random>Random</a></li></ul></li><li><a href=#addendum aria-label=Addendum>Addendum</a></li></ul></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>WordPress is clearly one of the world&rsquo;s most used Content Management Systems
(CMS) commanding over 35% of the internet, and over 60% of the CMS market
<a href=#w3techs>[1]</a>.</p><p>Working in Operations (ops), you see your fair share of friends, family and
businesses that ask you to set up a WordPress site as their go to blogging
platform. This really comes down to WordPress&rsquo; ease of use, massive library of
themes and it&rsquo;s modular nature that enables the extension of it&rsquo;s core via the
use of plugins.</p><p>After hearing one of my clients wanting to move forward with another WordPress
site, I thought it was a good time to investigate PHP 7.2/.3/.4, clean up my
<code>docker-compose</code> stack and experiment with different caching technologies in
order to make it load as fast as possible for end-users.</p><h2 id=science->Science! ðŸ§ª<a hidden class=anchor aria-hidden=true href=#science->#</a></h2><p>Initially my WordPress deployment comprised of MySQL, php-fpm (PHP FastCGI Process Manager),
and nginx with no caching optimizations. In order to work out if the optimizations
were actually doing anything, I needed to gain a baseline benchmark using my
current stack. Luckily, since everything was composed via docker, this was very
easy to do.</p><h3 id=method>Method<a hidden class=anchor aria-hidden=true href=#method>#</a></h3><p>In order to keep the variables under control the following hardware and
software was used across all benchmark tests:</p><p>Hardware:</p><ul><li>Mac Book Pro 2011<ul><li>CPU: IntelÂ® Coreâ„¢ i7-2720QM CPU @ 2.20GHz Ã— 8</li><li>RAM: 3.8GiB</li><li>OS: Ubuntu 18.04.4 64-bit</li></ul></li></ul><p>Software:</p><ul><li>WordPress version 5.3.2</li><li>NGINX version 1.16.1</li><li>MariaDB version 10.4.12</li><li>Docker 19.03.8</li><li>Docker Compose v1.25.4</li><li>Hey v0.1.3 <a href=#hey-benchmark>[2]</a>.</li></ul><p><em>~ Shameless Self Promotion ~</em></p><ul><li>stackme <a href=#stackme>[3]</a> - to provide a base docker-compose stack to get WordPress up and running.</li></ul><p>PHP Configurations:</p><ul><li>php-fpm 7.2.28</li><li>php-fpm 7.2.28 + opcache</li><li>php-fpm 7.2.28 + opcache + varnish cache</li><li>php-fpm 7.2.28 + opcache + w3 total cache plugin</li><li>php-fpm 7.2.28 + opcache + w3 total cache plugin + varnish cache</li><li>php-fpm 7.3.15</li><li>php-fpm 7.3.15 + opcache</li><li>php-fpm 7.3.15 + opcache + varnish cache</li><li>php-fpm 7.3.15 + opcache + w3 total cache plugin</li><li>php-fpm 7.3.15 + opcache + w3 total cache plugin + varnish cache</li><li>php-fpm 7.4.3</li><li>php-fpm 7.4.3 + opcache</li><li>php-fpm 7.4.3 + opcache + varnish cache</li><li>php-fpm 7.4.3 + opcache + w3 total cache plugin</li><li>php-fpm 7.4.3 + opcache + w3 total cache plugin + varnish cache</li></ul><p>I decided to opt for <code>hey</code> as the choice of benchmark tool, as it&rsquo;s similar to
the apache benchmark tool (ab), but more modern, capable of using multiple cpus.</p><p>Our default benchmark will be run using the following configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hey -z 60s -o csv http://localhost:80
</span></span></code></pre></div><p>This configures hey to flood the WordPress server for 60 seconds with requests,
with a default of 50 worker threads.</p><h3 id=hypothesis>Hypothesis<a hidden class=anchor aria-hidden=true href=#hypothesis>#</a></h3><ul><li>PHP by itself will be the slowest</li><li>PHP with OpCache should provide minor performance boosts</li><li>PHP with w3TotalCache should be pretty performant, but will be limited by PHP.</li><li>PHP with Varnish should be the fastest, as it doesn&rsquo;t have to hit PHP after
initial page render.</li></ul><h2 id=results>Results<a hidden class=anchor aria-hidden=true href=#results>#</a></h2><p>One thing I was surprised about was how much of a difference OpCache made in
terms of processor usage and the impact that had to response time. I guess it
shows how much overhead the interpreter can cause. (check out the screenshots
under <a href=#system-stats>extras for nerds</a>)</p><p>Having used other languages such as Python <a href=#python-bytecode>[4]</a>,
and Java <a href=#java-bytecode>[5]</a> I was somewhat surprised that
PHP&rsquo;s OpCache wasn&rsquo;t added until 2012. That&rsquo;s only 8 years ago&mldr;</p><p>The other compounding issue with OpCache is that, while it has been bundled with
PHP since version 5.5 <a href=#php-opcache>[6]</a>, it may not be enabled
by default depending on where you get the binary from, or if your <code>php.ini</code>
file hasn&rsquo;t set <code>opcache.enable=1</code>. So make sure to enable this if you can!</p><p>Lastly, my hypothesis about Varnish turned out to be correct, but I did find
that having W3TotalCache enabled as well added extra overhead, so you probably
don&rsquo;t need to use both.</p><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/response-times-php.png srcset="/images/2020-03-29-optimizing-wordpress/response-times-php_hu1cc6dbe773d9a936e51fa2341314ebd9_43299_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/response-times-php_hu1cc6dbe773d9a936e51fa2341314ebd9_43299_800x0_resize_box_3.png 800w"><figcaption>fig 1. PHP Response Times and PHP With OpCache Enabled, without caching.</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/response-times-php-with-cache.png srcset="/images/2020-03-29-optimizing-wordpress/response-times-php-with-cache_hu94199d33841250dc9d7b844046e286a9_36925_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/response-times-php-with-cache_hu94199d33841250dc9d7b844046e286a9_36925_800x0_resize_box_3.png 800w"><figcaption>fig 2. PHP With OpCache Enabled, with different caching strategies</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/requests-per-second-all.png srcset="/images/2020-03-29-optimizing-wordpress/requests-per-second-all_hu57ed1b039abef84f5e522a0a920d8200_35948_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/requests-per-second-all_hu57ed1b039abef84f5e522a0a920d8200_35948_800x0_resize_box_3.png 800w"><figcaption>fig 3. Requests per Second, with different caching strategies</figcaption></figure><h2 id=conclusiontldr>Conclusion/TL;DR<a hidden class=anchor aria-hidden=true href=#conclusiontldr>#</a></h2><ul><li>Where possible, always run PHP with OpCache enabled.</li><li>If you can&rsquo;t run varnish, enable w3TotalCache - it&rsquo;s pretty damn performant.</li><li>For best performance, run with varnish.</li></ul><h2 id=last-thoughts-and-disclaimers>Last Thoughts and Disclaimers<a hidden class=anchor aria-hidden=true href=#last-thoughts-and-disclaimers>#</a></h2><p>This benchmark runs with the best performance you can get out of WordPress. It&rsquo;s
a fresh installation with no other plugins enabled. This enabled testing of the
underlying technologies - therefore mileage may vary depending on how many
plugins you have enabled on your WordPress site.</p><p>I found to get the best out of W3TotalCache a lot of settings had to be tweaked
to get it to work for anything other than the main/front page. So do experiment
to ensure you get the best you can out of it.</p><p>In this benchmark, W3TotalCache was configured to make use of PHP&rsquo;s Alternative
PHP Cache (APC) for object caching. APC provides an in memory caching API that
developers can use.</p><p>Certain default Caching technologies may not work well for sites that make use
of backend processing on the fly. That said, if your WordPress site uses
JavaScript to update the loaded page and API calls, you should be safe. In any
case it&rsquo;s best to run a test site introducing your caching technology before
fully rolling it out.</p><h2 id=extras-for-nerds>Extras for Nerds<a hidden class=anchor aria-hidden=true href=#extras-for-nerds>#</a></h2><p>&lsquo;Sup Nerds. Check out some extra graphs around system stats and overall
performance with max response times.</p><p><a href=https://github.com/matthewhartstonge/wp-bench>Benchmark repository</a> including benchmark scripts, the raw data and database.</p><h3 id=moar-response-time-graphs>Moar Response Time Graphs<a hidden class=anchor aria-hidden=true href=#moar-response-time-graphs>#</a></h3><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/response-times-all.png srcset="/images/2020-03-29-optimizing-wordpress/response-times-all_hu00165e79fe56509ddaf50afe814f7304_40024_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/response-times-all_hu00165e79fe56509ddaf50afe814f7304_40024_800x0_resize_box_3.png 800w
, /images/2020-03-29-optimizing-wordpress/response-times-all_hu00165e79fe56509ddaf50afe814f7304_40024_1200x0_resize_box_3.png 1200w"><figcaption>fig 4. Performance across all variants</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/response-times-php-with-cache-max.png srcset="/images/2020-03-29-optimizing-wordpress/response-times-php-with-cache-max_hu43160b0dd792f383bb39f34ac4d63443_37237_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/response-times-php-with-cache-max_hu43160b0dd792f383bb39f34ac4d63443_37237_800x0_resize_box_3.png 800w"><figcaption>fig 5. PHP With OpCache Enabled, with different caching strategies, including Maximum Response time</figcaption></figure><h3 id=system-stats>System Stats<a hidden class=anchor aria-hidden=true href=#system-stats>#</a></h3><p>I grabbed screenshots for the first round of benchmarking to see what the
impact each stack/configuration would have on CPU and RAM usage. RAM Usage was
fairly similar, but CPU Usage differed a lot.</p><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/base-stats.png srcset="/images/2020-03-29-optimizing-wordpress/base-stats_hu1c57343a25282ed1c2f1ebd8e7352e0c_66838_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/base-stats_hu1c57343a25282ed1c2f1ebd8e7352e0c_66838_800x0_resize_box_3.png 800w"><figcaption>fig 6. Base System Metrics</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/7.2.png srcset="/images/2020-03-29-optimizing-wordpress/7.2_hu7c5758cb4de60216b865f6c56baf68a8_129645_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/7.2_hu7c5758cb4de60216b865f6c56baf68a8_129645_800x0_resize_box_3.png 800w"><figcaption>fig 7. PHP 7.2 Metrics</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/7.2-opcache.png srcset="/images/2020-03-29-optimizing-wordpress/7.2-opcache_hu9b0a4288b9eb04ad3fe17f1dd2d8e44b_87384_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/7.2-opcache_hu9b0a4288b9eb04ad3fe17f1dd2d8e44b_87384_800x0_resize_box_3.png 800w"><figcaption>fig 8. PHP 7.2 OpCache Enabled Metrics</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache.png srcset="/images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache_huc60e1dee43e57be3773d2299a5dd6dd6_88437_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache_huc60e1dee43e57be3773d2299a5dd6dd6_88437_800x0_resize_box_3.png 800w"><figcaption>fig 9. PHP 7.2 OpCache Enabled Metrics, With W3TotalCache</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/7.2-opcache-varnish.png srcset="/images/2020-03-29-optimizing-wordpress/7.2-opcache-varnish_hu7a268d3d30c6f93a4c72a4a9ef4970ba_91810_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/7.2-opcache-varnish_hu7a268d3d30c6f93a4c72a4a9ef4970ba_91810_800x0_resize_box_3.png 800w"><figcaption>fig 10. PHP 7.2 OpCache Enabled Metrics, With Varnish</figcaption></figure><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache-varnish.png srcset="/images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache-varnish_hu9db05da690c463146508318fba6fd73d_92001_500x0_resize_box_3.png 500w
, /images/2020-03-29-optimizing-wordpress/7.2-opcache-w3totalcache-varnish_hu9db05da690c463146508318fba6fd73d_92001_800x0_resize_box_3.png 800w"><figcaption>fig 11. PHP 7.2 OpCache Enabled Metrics, With W3TotalCache and Varnish</figcaption></figure><h3 id=random>Random<a hidden class=anchor aria-hidden=true href=#random>#</a></h3><p>I found it interesting that W3TotalCache injected an HTML comment, which could
be useful while debugging performance metrics for those of you heading down the
W3TotalCache route.</p><figure><img loading=lazy sizes="(min-width: 35em) 720px, 100vw" src=/images/2020-03-29-optimizing-wordpress/w3-enabled.png srcset="/images/2020-03-29-optimizing-wordpress/w3-enabled_hucc809f224ec58dfe13e2836367a25bc1_16106_500x0_resize_box_3.png 500w"><figcaption>fig 12. W3TotalCache adds caching information in an HTML comment</figcaption></figure><h2 id=addendum>Addendum<a hidden class=anchor aria-hidden=true href=#addendum>#</a></h2><ul><li>Time to Blog: 16h:15m</li></ul></div><h2>References</h2><ol><li id=w3techs>W3Techs. (n.d.) <i>"Usage statistics and market share of WordPress."</i> Retrieved March 16, 2020, from <a rel=noopener target=_blank href=https://w3techs.com/technologies/details/cm-wordpress>https://w3techs.com/technologies/details/cm-wordpress</a>.</li><li id=hey-benchmark>Jaana Dogan. (n.d.) <i>"Hey - HTTP load generator, ApacheBench (ab) replacement, formerly known as rakyll/boom.."</i> Retrieved March 17, 2020, from <a rel=noopener target=_blank href=https://github.com/rakyll/hey>https://github.com/rakyll/hey</a>.</li><li id=stackme>Matthew Hartstonge. (n.d.) <i>"stackme - An Nginx, PHP-FPM, Maria/Postgres Stack for CMS's."</i> Retrieved March 29, 2020, from <a rel=noopener target=_blank href=https://github.com/matthewhartstonge/stackme>https://github.com/matthewhartstonge/stackme</a>.</li><li id=python-bytecode>Wikipedia. (2020-02-26) <i>"CPython."</i> Retrieved March 29, 2020, from <a rel=noopener target=_blank href=https://en.wikipedia.org/wiki/CPython>https://en.wikipedia.org/wiki/CPython</a>.</li><li id=java-bytecode>Wikipedia. (2020-02-19) <i>"Java bytecode."</i> Retrieved March 29, 2020, from <a rel=noopener target=_blank href=https://en.wikipedia.org/wiki/Java_bytecode>https://en.wikipedia.org/wiki/Java_bytecode</a>.</li><li id=php-opcache>The PHP Group. (n.d.) <i>"PHP: OpCache."</i> Retrieved March 29, 2020, from <a rel=noopener target=_blank href=https://www.php.net/manual/en/intro.opcache.php>https://www.php.net/manual/en/intro.opcache.php</a>.</li></ol><footer class=post-footer><ul class=post-tags><li><a href=https://blog.mykro.co.nz/tags/cache/>Cache</a></li><li><a href=https://blog.mykro.co.nz/tags/devops/>DevOps</a></li><li><a href=https://blog.mykro.co.nz/tags/docker/>Docker</a></li><li><a href=https://blog.mykro.co.nz/tags/nginx/>Nginx</a></li><li><a href=https://blog.mykro.co.nz/tags/optimization/>Optimization</a></li><li><a href=https://blog.mykro.co.nz/tags/opcache/>opcache</a></li><li><a href=https://blog.mykro.co.nz/tags/php/>php</a></li><li><a href=https://blog.mykro.co.nz/tags/php-fpm/>php-fpm</a></li><li><a href=https://blog.mykro.co.nz/tags/wordpress/>WordPress</a></li><li><a href=https://blog.mykro.co.nz/tags/varnish/>Varnish</a></li></ul></footer></article></main><footer class=footer><span>Â© Copyright 2023 Matthew Hartstonge</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>